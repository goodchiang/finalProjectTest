<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
          <title>My Dashboard</title>
          <meta name="viewport" content="width=device-width">
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
          <link rel="stylesheet" href="css/index.css">
          <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
          <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
          <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
          <script src="js/keyNew.js"></script> 
    </head>

    <body>
        <header>
            <p class="notLogin">未登入</p>
            <!-- <a id="loginBtn" href="logIn.html">登入</a> -->
            <button id="fbloginBtn" class="btn btn-primary" type="submit">臉書登入</button>
            <button id="logoutBtn" class="btn btn-danger">登出</button>
            <a class="navbar-brand" href="index.html">來一起自拍</a>
            <!--導覽列內容-->
            <div class="collapse navbar-collapse" id="navbar">
                <ul class="nav navbar-nav">
                    <li><div id="fbPic"></div></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="upload.html">Upload</a></li>
                </ul>                  
            </div>      
        </header>

        <article>
            <div id="indexView">
                <div id="fbImgView"></div>
            </div>
        </article>


        <script>
          if (!Parse.User.current()){
            alert("你尚未登入");
            window.location = "index.html";
          }

          $(document).ready(function(){
              var current = Parse.User.current();
              console.log(current);
              if(current){
                  var a = setTimeout(function(){
                  FB.getLoginStatus(function(response) {
                      if (response.status === 'connected') {
                          uid = response.authResponse.userID;
                          accessToken = response.authResponse.accessToken;
                          FB.api('/me/picture?type=large', function (response) {
                             $('#fbImgView').html("<img src="+response.data.url+" crossorigin=\"anonymous\" id=preview1 />");          
                             });
                     
                          FB.api('/me', function (response) {
                              console.log(response);
                              $('#fbImgView').append("<h1>HELLO , "+ response['first_name']+"</h1>");
                          });
                      }
                     });   
                  },3000);
                indexView();
              }
              else{
                loginView();
              }
            });

            $(document).on('click','#fbloginBtn',function(e){
              e.preventDefault();
              fblogin();
            });
            $(document).on('click','#logoutBtn',function(e){
              e.preventDefault();
              logout();
            });

            function loginView(){
              $('#logoutBtn').hide();
              $('#indexView').hide();
              
              $('#loginView').show();
              $('.notLogin').show();
              $('#fbImgView').html('');
              
            }

            function indexView(){
              $('#loginView').hide();
              $('.notLogin').hide();
              
              $('#indexView').show();
              $('#logoutBtn').show();
            }

            function logout(){
               Parse.User.logOut();
               FB.logout(function(response) {
                 // user is now logged out
               });
               loginView(); 
            }

        </script>

    </body>
</html>
