<!DOCTYPE html>
 <html>
      <head class="col-md-4" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
          <meta property="og:type" content="article" />
          <meta property="og:url" content="http://goodchiang.github.io/finalProjectTest/homepage.html" />
          <meta property="og:title" content="Selfie With Me / NCCU Web Programming" />
          <meta property="og:description" content="Facebook Open Graph Test" />
          <meta property="og:image" content="http://goodchiang.github.io/finalProjectTest/img/img.png" />
          <!--https://developers.facebook.com/docs/reference/opengraph/object-type/article-->
          <meta charset="utf-8">
          <title>來一起自拍！</title>
          <meta name="viewport" content="width=device-width">
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
          <link rel="stylesheet" href="css/index.css">
          <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
          <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
          <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
          <script src="js/keyNew.js"></script> 
      </head>

      <body>
          <header>
              <p class="notLogin">未登入</p>
              <!-- <a id="loginBtn" href="logIn.html">登入</a> -->
              <button id="fbloginBtn" class="btn btn-primary" type="submit">臉書登入</button>
              <button id="logoutBtn" class="btn btn-danger">登出</button>

              <a class="navbar-brand" href="index.html">來一起自拍</a>
              <!--導覽列內容-->
              <div class="collapse navbar-collapse" id="navbar">
                   <ul class="nav navbar-nav">
                      <li><div id="fbPic"></div></li>
                      <li><a href="dashboard.html">Dashboard</a></li>
                  </ul>                  
              </div>
              
          </header>
          <div class="fb-like" data-share="true" data-width="450" data-show-faces="true"></div>
          <article>
              <section>
                  <div class="col-md-10">
                      <div class="pics-nav">
                          <ul class="nav nav-tabs">
                              <li role="presentation"><a href="#">最新</a></li>
                              <li role="presentation"><a href="#">熱門</a></li>
                              <li role="presentation"><a href="#">地點</a></li>
                          </ul>
                      </div>
                      <div id="pics">
                      </div>
                  </div>       
              </section>
          </article>

          <footer>
              <div class="col-md-12 copyright"> Copyright © 2015 WebPrograming Group 1. All Rights Reserved.</div>
          </footer>
    
          <script>
              //step1:https://www.parse.com/docs/js/guide#users-facebook-users
              // Initialize Parse
              Parse.initialize("3Ct29PJCet8L8kfhLvbLTJ3DLKRC61RAp7ysXFU6", "3yHxjy4EBgJTMWYBuP1T7rG4qOHiiOuAnokZB5jb");
              window.fbAsyncInit = function() {
                  Parse.FacebookUtils.init({ // this line replaces FB.init({
                      appId      : '1070568829637766', // Facebook App ID
                      status     : true,  // check Facebook Login status
                      cookie     : true,  // enable cookies to allow Parse to access the session
                      xfbml      : true,  // initialize Facebook social plugins on the page
                      version    : 'v2.3' // point to the latest Facebook Graph API version
                  });
                  // Run code after the Facebook SDK is loaded.
              };
              (function(d, s, id){
                  var js, fjs = d.getElementsByTagName(s)[0];
                  if (d.getElementById(id)) {return;}
                  js = d.createElement(s); js.id = id;
                  js.src = "//connect.facebook.net/en_US/sdk.js";
                  fjs.parentNode.insertBefore(js, fjs);
                  }(document, 'script', 'facebook-jssdk'));


              function fblogin(){
                  //step2:https://developers.facebook.com/docs/graph-api/using-graph-api/v2.3 
                  Parse.FacebookUtils.logIn(null, {
                      success: function(user) {
                          if (!user.existed()) {
                              alert("註冊完成並且透過臉書登入");
                          } else {
                              alert("透過臉書登入成功");
                          }
                          indexView();//切換至預先寫好登入後的介面
                          FB.getLoginStatus(function(response) {
                              if (response.status === 'connected') {
                                  FB.api('/me/picture?type=large', function (response) {
                                      $('#fbPic').html("<img src="+response.data.url+" crossorigin=\"anonymous\" id=preview1 />");          
                                  });
                             
                                  FB.api('/me', function (response) {
                                      console.log(response);
                                      $('#fbImgView').append("<h1>Welcome , "+(response['gender']=="male"?"Mr. ":"Miss ")+" "+response['first_name']+"</h1>");
                                  });            
                              }
                          }); 
                      },
                      error: function(user, error) {
                          alert("使用者取消登入或沒有授權");
                      }
                  });
              }
              
              // Practice 2  這裏要補充兩行不見的程式碼
              var Comment = Parse.Object.extend("Comment") ;
              var queryComments = new Parse.Query (Comment) ;

              // Practice 3  要將關聯的資料也一起抓下來
              queryComments.include("writer") ; // 在 query 時必須要 include 該欄位，才會抓取該欄位的資料


              // Practice 4  只顯示目前使用者的留言
              //queryComments.equalTo("writer",Parse.User.current());

              // Practice 6  只抓取有圖片的留言
              //queryComments.exists("img");


              queryComments.find({
                success : function(arrayOfQueriedObjects){
                  console.log (arrayOfQueriedObjects);
            
                  for (var i = 0 ; i < arrayOfQueriedObjects.length ; i++){
                    comment = arrayOfQueriedObjects[i] ;
            
                    $("#pics").append(
                      "<blockquote>"+
                        comment.get("writer").get("username") + ": " +comment.get("message")+
                        "<br><img src='"+ comment.get("img").url()+"' height='100px'>"+  // Practice 6
                      "</blockquote>");
                  }
                },
                error : function(errorObject){
                  alert(errorObject.message) ;
                }
              });
            });


          </script>
          <script src="js/logIn.js"></script>        
    </body>
</html>